<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code 监控平台</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 背景动画 -->
    <div class="bg-animation">
        <div class="grid-lines"></div>
        <div class="particles" id="particles"></div>
    </div>

    <!-- 主容器 -->
    <div class="container">
        <!-- 顶部标题栏 -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 100 100" class="logo-svg">
                        <circle cx="50" cy="50" r="45" class="logo-circle"/>
                        <path d="M30 50 L45 65 L70 35" class="logo-check"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>CLAUDE CODE</h1>
                    <span class="subtitle">MONITORING SYSTEM</span>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-label">状态</span>
                    <span class="stat-value status-indicator" id="status">
                        <span class="pulse"></span>
                        <span class="status-text">连接中...</span>
                    </span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">事件总数</span>
                    <span class="stat-value" id="total-events">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">运行时间</span>
                    <span class="stat-value" id="uptime">00:00:00</span>
                </div>
            </div>
            <div class="header-controls">
                <button class="btn btn-icon" id="settings-toggle" title="设置">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                </button>
                <button class="btn btn-icon" id="fullscreen-toggle" title="全屏">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- 字幕提醒区域 -->
        <div class="subtitle-bar" id="subtitle-bar">
            <div class="subtitle-content" id="subtitle-content">
                <span class="subtitle-icon">●</span>
                <span class="subtitle-text">系统就绪，等待事件...</span>
            </div>
        </div>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 左侧面板 - 会话列表 -->
            <section class="panel panel-sessions">
                <div class="panel-header">
                    <h2><span class="icon-task"></span>活跃会话</h2>
                    <div class="session-count-badge">
                        <span id="session-count">0</span>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="session-list" id="session-list">
                        <div class="session-empty">
                            <div class="empty-icon">💻</div>
                            <p>暂无活跃会话</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 中间面板 - 统计和可视化 -->
            <section class="panel panel-stats">
                <div class="panel-header">
                    <h2><span class="icon-chart"></span>数据统计</h2>
                </div>
                <div class="panel-body">
                    <!-- 事件类型统计 -->
                    <div class="stats-grid">
                        <div class="stat-card" data-type="PreToolUse">
                            <div class="stat-card-icon">🔧</div>
                            <div class="stat-card-info">
                                <span class="stat-card-value" id="stat-PreToolUse">0</span>
                                <span class="stat-card-label">工具调用</span>
                            </div>
                        </div>
                        <div class="stat-card" data-type="UserPromptSubmit">
                            <div class="stat-card-icon">💬</div>
                            <div class="stat-card-info">
                                <span class="stat-card-value" id="stat-UserPromptSubmit">0</span>
                                <span class="stat-card-label">用户输入</span>
                            </div>
                        </div>
                        <div class="stat-card" data-type="Stop">
                            <div class="stat-card-icon">✅</div>
                            <div class="stat-card-info">
                                <span class="stat-card-value" id="stat-Stop">0</span>
                                <span class="stat-card-label">响应完成</span>
                            </div>
                        </div>
                        <div class="stat-card" data-type="SubagentStop">
                            <div class="stat-card-icon">🤖</div>
                            <div class="stat-card-info">
                                <span class="stat-card-value" id="stat-SubagentStop">0</span>
                                <span class="stat-card-label">子代理</span>
                            </div>
                        </div>
                    </div>

                    <!-- 工具使用排行 -->
                    <div class="tools-ranking">
                        <h3>工具使用排行</h3>
                        <div class="ranking-list" id="tools-ranking">
                            <div class="ranking-empty">暂无数据</div>
                        </div>
                    </div>

                    <!-- 活动图表 -->
                    <div class="activity-chart">
                        <h3>活动时间线</h3>
                        <div class="chart-container" id="activity-chart">
                            <canvas id="activity-canvas"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 右侧面板 - 事件流 -->
            <section class="panel panel-events">
                <div class="panel-header">
                    <h2><span class="icon-pulse"></span>实时事件流</h2>
                    <div class="panel-actions">
                        <button class="btn btn-sm" id="clear-events">清空</button>
                        <button class="btn btn-sm" id="pause-events">暂停</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="event-list" id="event-list">
                        <!-- 事件项将动态插入 -->
                    </div>
                </div>
            </section>
        </main>

        <!-- 底部状态栏 -->
        <footer class="footer">
            <div class="footer-left">
                <span class="connection-info">
                    <span class="dot" id="ws-dot"></span>
                    WebSocket: <span id="ws-status">断开</span>
                </span>
            </div>
            <div class="footer-center">
                <span id="current-time"></span>
            </div>
            <div class="footer-right">
                <span>Claude Code Monitor v1.0</span>
            </div>
        </footer>
    </div>

    <!-- 音频元素 -->
    <audio id="audio-event" preload="auto"></audio>

    <!-- 设置弹窗 -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>系统设置</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 音频设置 -->
                <div class="settings-section">
                    <h3>🔊 音频通知设置</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-PreToolUse">
                                <span>工具调用前 (PreToolUse)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-PostToolUse">
                                <span>工具调用后 (PostToolUse)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-PermissionRequest">
                                <span>权限请求 (PermissionRequest)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-UserPromptSubmit">
                                <span>用户提交 (UserPromptSubmit)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-Notification">
                                <span>通知 (Notification)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-Stop">
                                <span>响应完成 (Stop)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-SubagentStop">
                                <span>子代理完成 (SubagentStop)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-PreCompact">
                                <span>压缩前 (PreCompact)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-SessionStart">
                                <span>会话开始 (SessionStart)</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="sound-SessionEnd">
                                <span>会话结束 (SessionEnd)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 钉钉推送设置 -->
                <div class="settings-section">
                    <h3>📱 钉钉推送设置</h3>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="dingtalk-enabled">
                            <span>启用钉钉推送</span>
                        </label>
                    </div>
                    <div class="setting-input-group">
                        <label>Webhook URL</label>
                        <input type="text" id="dingtalk-webhook" placeholder="https://oapi.dingtalk.com/robot/send?access_token=...">
                    </div>
                    <div class="setting-input-group">
                        <label>Secret (可选)</label>
                        <input type="text" id="dingtalk-secret" placeholder="SEC...">
                    </div>
                    <div class="setting-input-group">
                        <label>推送事件类型</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" class="dingtalk-event" value="PermissionRequest"> 权限请求</label>
                            <label><input type="checkbox" class="dingtalk-event" value="Stop"> 响应完成</label>
                            <label><input type="checkbox" class="dingtalk-event" value="SubagentStop"> 子代理完成</label>
                            <label><input type="checkbox" class="dingtalk-event" value="SessionStart"> 会话开始</label>
                            <label><input type="checkbox" class="dingtalk-event" value="SessionEnd"> 会话结束</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="settings-cancel">取消</button>
                <button class="btn btn-primary" id="settings-save">保存设置</button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
